**INDEX**
- [Redis Pub/Sub 기능](#redis-pubsub-기능)
- [pubsub 문법](#pubsub-문법)
  - [subscribe \<구독채널\>](#subscribe-구독채널)
  - [publish](#publish)
- [Redis Pub/Sub 채팅 시스템을 예시로 정리](#redis-pubsub-채팅-시스템을-예시로-정리)
  - [개요](#개요)
  - [구성 요소](#구성-요소)
  - [동작 흐름](#동작-흐름)
  - [장점](#장점)
  - [메시지 큐를 활용하는 방법](#메시지-큐를-활용하는-방법)

<br>

## Redis Pub/Sub 기능
- Redis에서 제공하는 기능이다.
- Redis를 활용하여 메시지를 발행하고 구독하는 기능이다.
- 한 번 발송된 메시지는 저장되지 않는다.(연결되어 있지 않으면 메시지를 받지못해 큐를 활용하여 보완한다.)
- 보통 멀티 서버로 구성된 서비스에서 알림이나 채팅 기능을 구현할 때 활용된다.
- 비동기적인 통신을 지원하여 클라이언트 간의 직접적인 연결 없이도 메시지를 전달할 수 있다.

<br>

## pubsub 문법

### subscribe <구독채널>
```docker
127.0.0.1:6379(subscribed mode)> subscribe test_channel
1) "subscribe"
2) "test_channel"
3) (integer) 2
```
### publish
```docker
127.0.0.1:6379> publish test_channel "hi"

127.0.0.1:6379(subscribed mode)>
1) "message"
2) "test_channel"
3) "hi"
```
<br>

## Redis Pub/Sub 채팅 시스템을 예시로 정리
### 개요
- Redis의 Pub/Sub 기능을 사용하여 멀티 서버 환경에서 클라이언트 간의 메시지를 전달하는 시스템이다.
### 구성 요소
- 서버1: 클라이언트1과 연결된 서버이다.
- 서버2: 클라이언트2와 연결된 서버이다.
- 클라이언트1: 서버1에 연결된 사용자이다.
- 클라이언트2: 서버2에 연결된 사용자이다.
- Redis: 메시지 발행 및 구독을 관리하는 데이터베이스이다.
### 동작 흐름
1. 구독 설정:
   - 서버1과 서버2는 Redis의 특정 채널을 구독한다. 이 채널은 클라이언트 간의 메시지를 전달하는 데 사용된다.

2. 메시지 발행:
   - 클라이언트1이 클라이언트2에게 메시지를 보내고자 할 때, 서버1은 Redis에 해당 메시지를 발행한다. 이때 메시지에는 클라이언트2의 정보가 포함된다.

3. 메시지 전달:
   - Redis는 서버2가 구독하고 있는 채널에 메시지를 전달한다. 이 과정에서 Redis는 메시지와 함께 발신자(클라이언트1)의 정보를 포함한다.

4. 메시지 수신 및 전달:
   - 서버2는 Redis로부터 발행된 메시지를 수신하고, 자신이 클라이언트2와 연결되어 있는지 확인한다.
   - 서버2가 클라이언트2와 연결되어 있다면, 서버2는 클라이언트2에게 해당 메시지를 전달한다.
### 장점
- 확장성: 여러 서버가 Redis를 통해 메시지를 주고받을 수 있어, 시스템의 확장성이 높다.
- 비동기 처리: 클라이언트 간의 직접적인 연결 없이도 메시지를 전달할 수 있어, 비동기적인 통신이 가능하다.
주의사항
- Pub/Sub 모델은 메시지를 수신하지 못한 클라이언트에게 메시지를 저장하지 않기 때문에, 클라이언트가 연결되어 있지 않을 경우 메시지를 잃어버릴 수 있다. 이를 보완하기 위해 메시지 큐를 사용하는 방법도 고려할 수 있다.

<br>

### 메시지 큐를 활용하는 방법
1. **메시지 발행** : 클라이언트가 메시지를 보내면, 그 메시지는 Redis의 Pub/Sub 대신 메시지 큐에 저장된다.
2. **메시지 저장** : 메시지는 큐에 저장되어, 클라이언트가 연결되어 있지 않더라도 사라지지 않는다.(클라이언트 인터넷이 안된다던가 할 경우 일반 pub/sub은 메시지를 잃어버려 메시지 전달 실패한다.)
3. **메시지 수신** : 클라이언트가 나중에 연결되면, 큐에서 메시지를 꺼내서 읽을 수 있다. 이렇게 하면 메시지를 잃어버리지 않고, 모든 클라이언트가 필요한 메시지를 받을 수 있다.